# Static Binary & Source Code Analysis with LLM

This project provides a **static code and binary security analysis framework** enhanced with **LLM reasoning**. It automates the extraction of indicators from binaries and source code, correlates findings, and produces a risk assessment.

---

## Table of Contents

- [Overview](#overview)  
- [Architecture](#architecture)  
- [Supported Analysis](#supported-analysis)  
- [Agent & LLM Workflow](#agent--llm-workflow)  
- [Directory Structure](#directory-structure)  
- [Usage](#usage)  

---

## Overview

The system analyzes both **compiled binaries** and **source code** to detect:

- Anti-debugging and anti-analysis techniques  
- Memory corruption vulnerabilities (GOT/PLT, RWX segments)  
- Dangerous or unsafe functions  
- Shellcode or embedded payloads  
- Packing, obfuscation, or self-extracting binaries  
- Malware family indicators  

It combines **classical static analysis tools** with **Python AST and ASTroid scans**, and optionally integrates **LLM reasoning** to summarize and correlate findings.

---

## Architecture

The framework is composed of:

### 1. Static Analysis Scripts (`static_script.py`)
- Detects file type: source vs binary  
- Runs multiple static tools in parallel threads for performance boost
- Produces log files in a structured format (`./static/`)  

### 2. Tool Abstraction Layer
- Interface: `StaticTool` (run command, log results)  
- Built-in implementations:  
  - `ReadElf`, `ObjDump`, `Strings`, `NM`, `LddSafe`, `Checksec`, `FileCmd`  
  - `ROPgadgetTool`, `Hexdump`, `Binwalk`, `Sha256`, `Md5`, `Ssdeep`, `Patchelf`  
- Python-specific tools:  
  - `ASTScanner` (detect dangerous calls)  
  - `ASTroidScanner` (detect suspicious imports)  
  - `Bandit` (static vulnerability scan)  

### 3. LLM Agent Layer
- Orchestrated via YAML configuration (`static-binary-analysis-with-llm.yaml`)  
- Inputs: paths to logs from the pre-scripts  
- Prompt instructs the LLM to:  
  - Correlate findings across all static tools  
  - Detect suspicious behavior, obfuscation, anti-analysis  
  - Produce a risk level (**SAFE / SUSPICIOUS / DANGEROUS**)  
  - Output a structured findings report  

---

## Supported Analysis

### Source Code
- **Python**: AST, ASTroid, Bandit, strings scan  
- **Java**: (planned) AST parsing, import analysis, strings  
- **Other languages**: C/C++, Rust, Shell scripts (basic detection)  

### Binaries
- ELF, PE, Mach-O detection  
- Sections and segment layout  
- Relocations (GOT/PLT, RWX segments)  
- Executable stack, partial RELRO  
- Strings and hexdump extraction  
- ROP gadgets  
- Hashing and fuzzy matching  

---

## Agent & LLM Workflow

1. **Pre-scripts**  
   - The YAML file instructs the agent to run `static_script.py` for a given path.

2. **Log generation**  
   - Each tool produces a log in the `./static/` directory (one file per tool per binary/source).  

3. **LLM reasoning**  
   - Reads all logs via paths defined in YAML (`{{static_path}}/{{path}}.<tool>.log`)  
   - Correlates indicators (e.g., high-entropy sections + shellcode patterns)  
   - Produces:  
     - **Severity** (Informational / Medium / High / Critical)  
     - **Category** (anti-analysis, shellcode, unsafe-functions, etc.)  
     - **Evidence** (log snippets, line numbers, sections)  
   - Computes a **final risk level** for the artifact  

4. **Post-scripts**  
   - Formatting the LLM output into a structured report (`findings_report_path`)  

---

## Framework extends

Add new static tools: subclass StaticTool and implement command()
Add new languages: implement run_<language> function similar to sourcecode()
Custom LLM prompts: adjust YAML llm_prompt to incorporate additional indicators
Ghidra integration: for C/C++ binaries, decompile and extract functions via analyzeHeadless

## Usage

```python
python3 scripts/static_script.py /path/artifact
```
but not later than setting the virtual environment with the required modules
```python
python3 -m venv .venv
source .venv/bin/activate
pip install requirements.txt
```
also system requirements (APT)

```bash
sudo apt update
sudo apt install -y \
  python3 \
  python3-venv \
  python3-pip \
  binutils \
  file \
  coreutils \
  util-linux \
  libc-bin
sudo apt install -y \
  checksec \
  binwalk \
  ssdeep
sudo apt install -y ropgadget
#optionals
sudo apt install -y openjdk-17-jdk
sudo apt install -y openjdk-17-jdk unzip wget

#for environment validation
which objdump nm readelf strings ldd checksec binwalk ROPgadget bandit ssdeep
```
